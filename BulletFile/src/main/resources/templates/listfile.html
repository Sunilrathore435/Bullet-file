<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Bullet File</title>
    <link rel="icon" type="image/png" th:href="@{/style/assests/logo.png}" />
    
    <script src="https://kit.fontawesome.com/106a3659bb.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js" type="module"></script>
    <link rel="stylesheet" th:href="@{/style/css/listfile.css}" />
</head>
<body>

<div id="particles-js"></div>

<nav class="navbar">
    <!-- Left Section: Logout Button -->
     <div  class="navbar-brand-group">
        <img th:src="@{/style/assests/logo.png}" alt="BulletFile Logo" class="app-logo">
        <h2 class="app-name">Bullet-File</h2>
    </div>
  

    <!-- Center Section: Main Title -->
    <div class="navbar-section navbar-center">
        <h1 class="page-title">File Sharing Manager</h1>
    </div>

    <!-- Right Section: Logo and App Name -->
       <div class="navbar-section navbar-right">
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="logout-button">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </form>
    </div>
   
</nav>

<main class="main-content">
    <section class="upload-container">
        <h2 class="container-title">Upload New File</h2>

        <div th:if="${uploadSuccess}" class="upload-success-message">
            <dotlottie-wc class="success-animation" src="https://lottie.host/e22034e6-e2a2-408a-a0b1-91a022b31278/1s2v8y8k3C.lottie" speed="1" autoplay></dotlottie-wc>
            <p class="success-message-text">File uploaded successfully!</p>
            
            <dotlottie-wc 
                class="server-confirmation-animation"
                src="https://lottie.host/0a0dd037-770e-4797-99c4-1269896ca6cf/6IJSRBhzXu.lottie" 
                speed="1" autoplay loop>
            </dotlottie-wc>

            <a href="/files/home" class="upload-another-btn">Upload Another</a>
        </div>

        <form th:unless="${uploadSuccess}" action="/files/upload" method="post" enctype="multipart/form-data" id="uploadForm">
            <div class="drag-drop-area" id="dragDropArea">
                <div id="upload-prompt">
                    <dotlottie-wc 
                        src="https://lottie.host/88fd99af-287e-40de-97b0-f63ff53fcde6/PvxlgGX1b2.lottie" 
                        style="width: 300px; height: 300px;" 
                        speed="1" autoplay loop>
                    </dotlottie-wc>
                    <p>Drag & Drop file or</p>
                </div>
                
                <img id="image-preview" class="hidden" alt="Image preview"/>
                <i id="file-icon-preview" class="fas fa-file-alt hidden"></i>

                <input type="file" id="file-upload" name="file" class="file-input" required />
                <label for="file-upload" class="custom-file-upload">Choose File</label>
            </div>
            <span id="file-name" class="file-name">No file chosen</span>
            <button type="submit" class="upload-button">Upload File</button>
        </form>
    </section>

    <section class="uploaded-files-container">
        <h2 class="container-title">Your Uploaded Files</h2>
        <div class="table-wrapper">
            <table class="uploaded-files-table">
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Uploaded By</th>
                        <th>Share</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="fileTableBody">
                    <tr th:each="file, iterStat : ${files}" th:style="'animation-delay:' + ${iterStat.index * 0.1} + 's;'">
                        <td th:text="${file.fileName}">Example_Document.pdf</td>
                        <td th:text="${file.uploadedBy}">Sunil</td>
                        <td>
                            <form th:action="@{/files/share/{id}(id=${file.id})}">
                                <button type="submit" class="action-button share-button"><i class="fas fa-share-alt"></i></button>
                            </form>
                        </td>
                        <td>
                            <form th:action="@{/files/delete/{id}(id=${file.id})}" method="post" onsubmit="return confirm('Delete this file?');">
                                <button type="submit" class="action-button delete-button"><i class="fas fa-trash-alt"></i></button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</main>

<script>
    // Initialize Particles.js background
    particlesJS.load('particles-js', 'https://raw.githubusercontent.com/VincentGarreau/particles.js/master/demo/particles.json');

    const uploadForm = document.getElementById('uploadForm');
    if (uploadForm) {
        const fileInput = document.getElementById('file-upload');
        const dragDropArea = document.getElementById('dragDropArea');
        const fileNameDisplay = document.getElementById('file-name');
        
        // Preview elements
        const uploadPrompt = document.getElementById('upload-prompt');
        const imagePreview = document.getElementById('image-preview');
        const fileIconPreview = document.getElementById('file-icon-preview');

        // Function to reset the preview area
        function resetPreview() {
            uploadPrompt.classList.remove('hidden');
            imagePreview.classList.add('hidden');
            fileIconPreview.classList.add('hidden');
            fileNameDisplay.textContent = 'No file chosen';
        }

        // Function to handle file preview
        function displayFilePreview(file) {
            if (!file) {
                resetPreview();
                return;
            }

            // Show file name
            fileNameDisplay.textContent = file.name;

            // Hide the initial upload prompt
            uploadPrompt.classList.add('hidden');

            // Check if the file is an image
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    fileIconPreview.classList.add('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                // It's not an image, show a generic file icon
                imagePreview.classList.add('hidden');
                fileIconPreview.classList.remove('hidden');
            }
        }

        fileInput.addEventListener('change', function() {
            displayFilePreview(this.files[0]);
        });

        dragDropArea.addEventListener('dragover', (e) => { e.preventDefault(); dragDropArea.classList.add('drag-over'); });
        dragDropArea.addEventListener('dragleave', () => dragDropArea.classList.remove('drag-over'));
        dragDropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dragDropArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                displayFilePreview(files[0]);
            } else {
                resetPreview(); // If no files dropped, reset
            }
        });
    }
</script>
</body>
</html>